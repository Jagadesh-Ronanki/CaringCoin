// SPDX-License-Identifier: SEE LICENSE IN LICENSE
pragma solidity 0.8.9;

import 'forge-std/Script.sol';
import 'forge-std/console.sol';
import '../src/GovernorContract.sol';
import '../src/TimeLock.sol';
import '../src/GovernanceToken.sol';

interface IConstants {
  function setGovernor(address) external;
  function getGovernanceToken() external returns (address);
  function getTimeLock() external returns (address);
  function QUORUM_PERCENTAGE() external pure returns (uint256);
  function VOTING_PERIOD() external pure returns (uint256);
  function VOTING_DELAY() external pure returns (uint256);
}

contract DeployGovernorContract is Script{
  function run() external {
    console.log("Deploying Governor Contract...");

    uint256 deployerPrivateKey = vm.envUint("PRIVATE_KEY");
    vm.startBroadcast(deployerPrivateKey);
    // import constants
    address _constants = vm.envAddress("CONSTANTS_ADDRESS");
    IConstants constants = IConstants(_constants);

    // governance token address
    /* address governanceTokenAddress = vm.parseAddress(vm.envString("GOVERNANCE_TOKEN"));
    GovernanceToken governanceToken = GovernanceToken(governanceTokenAddress);
    IVotes token = IVotes(governanceToken); */

    address governanceTokenAddress = constants.getGovernanceToken();
    GovernanceToken governanceToken = GovernanceToken(governanceTokenAddress);
    console.log("Governance_address: ", address(governanceToken));
    
    // timelock address
    /* address timeLockAddress = vm.parseAddress(vm.envString("TIMELOCK"));
    TimeLock timeLock = TimeLock(payable(timeLockAddress));
    console.log("timelockaddress: ", address(timeLock));
 */

    address timeLockAddress = constants.getTimeLock();
    TimeLock timeLock = TimeLock(payable(timeLockAddress));
    console.log("timelock_address: ", address(timeLock));
    
    uint256 quorumPercentage = constants.QUORUM_PERCENTAGE();
    uint256 votingPeriod = constants.VOTING_PERIOD();
    uint256 votingDelay = constants.VOTING_DELAY();

    GovernorContract governorContract = new GovernorContract(governanceToken, timeLock, quorumPercentage, votingPeriod, votingDelay);
    console.log("Governor deployed at ", address(governorContract));
    /* vm.setEnv("GOVERNOR", vm.toString(address(governorContract))); */

    constants.setGovernor(payable(address(governorContract)));
  }
}